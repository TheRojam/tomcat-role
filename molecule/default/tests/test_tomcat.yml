---

http:
  http://localhost:{{ tomcat_http_connector_port }}:
    status: 200

service:
  tomcat:
    enabled: true
    running: true

user:
  {{ tomcat_user }}:
    exists: true
    groups:
      - {{ tomcat_group }}

group:
  {{ tomcat_group }}:
    exists: true

port:
  tcp:{{ tomcat_http_connector_port }}:
    listening: true
{% if tomcat_shutdown_port != -1 %}
  tcp:{{ tomcat_shutdown_port }}:
    listening: true
{% else %}
  tcp:8005:
    listening: false
{% endif %}
file:
{% for key, value in tomcat_pre_installed_folders_deployed.items() %}
  {{ tomcat_webapps_path }}/{{ key }}:
    exists: {{ value.deployed }}
{% endfor %}
  {{ tomcat_conf_path }}/test/test_file.xml:
    exists: true
  {{ tomcat_conf_path }}/test/test_template.xml:
    exists: true
{% if tomcat_download_wars %}
{% for war in tomcat_war_to_deploy_urls %}
  {{ tomcat_webapps_path }}/{{ war.name }}:
    exists: true
{% endfor %}
{% endif %}

command:
  java -cp {{ tomcat_install_path }}/lib/catalina.jar org.apache.catalina.util.ServerInfo | grep 'Server version':
    exit-status: 0
    stdout:
      - "{{ tomcat_version }}"
